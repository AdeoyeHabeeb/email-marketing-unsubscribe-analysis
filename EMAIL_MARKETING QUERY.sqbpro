<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="EMAIL_MARKETING QUERY.db" readonly="0" foreign_keys="0" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="3"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="1863"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><table title="Unsubscribes" custom_title="0" dock_id="1" table="4,12:mainUnsubscribes"/><dock_state state="000000ff00000000fd00000001000000020000039100000257fc0100000001fb000000160064006f0063006b00420072006f00770073006500310100000000000003910000013300ffffff0000026e0000000000000004000000040000000800000008fc00000000"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="Campaign_Performance" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="82"/><column index="2" value="67"/><column index="3" value="76"/><column index="4" value="73"/><column index="5" value="116"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Campaigns" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="80"/><column index="2" value="102"/><column index="3" value="87"/><column index="4" value="127"/><column index="5" value="68"/><column index="6" value="111"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Email_Engagement" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="97"/><column index="2" value="52"/><column index="3" value="82"/><column index="4" value="50"/><column index="5" value="47"/><column index="6" value="76"/><column index="7" value="159"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Unsubscribes" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="93"/><column index="2" value="52"/><column index="3" value="82"/><column index="4" value="109"/><column index="5" value="151"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="Users" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="50"/><column index="2" value="87"/><column index="3" value="78"/><column index="4" value="111"/><column index="5" value="59"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 1*">SELECT COUNT(*) FROM Users WHERE is_active = 1;

SELECT COUNT(*) FROM Users WHERE is_active = 0;

SELECT c.campaign_name, cp.total_opens
FROM Campaigns c
JOIN Campaign_Performance cp ON c.campaign_id = cp.campaign_id
ORDER BY cp.total_opens DESC
LIMIT 5;

SELECT reason, COUNT(*) AS count
FROM Unsubscribes
GROUP BY reason
ORDER BY count DESC;

SELECT c.campaign_name,
       cp.total_clicks*1.0 / cp.total_sent AS click_through_rate
FROM Campaigns c
JOIN Campaign_Performance cp ON c.campaign_id = cp.campaign_id
ORDER BY click_through_rate DESC;

--(1)What's the overall unsubscribe rate?

SELECT 
    SUM(total_unsubscribes) * 1.0 / SUM(total_sent) AS overall_unsubscribe_rate
FROM Campaign_Performance;

--(2)which campaigns had the highest and lowest unsubscribe rates?
SELECT 
    c.campaign_name,
    cp.total_unsubscribes * 1.0 / cp.total_sent AS unsubscribe_rate
FROM Campaigns c
JOIN Campaign_Performance cp ON c.campaign_id = cp.campaign_id
ORDER BY unsubscribe_rate DESC;
 
--OR 
 
-- FOR Highest
SELECT c.campaign_name, cp.total_unsubscribes*1.0/cp.total_sent AS unsubscribe_rate
FROM Campaigns c
JOIN Campaign_Performance cp ON c.campaign_id = cp.campaign_id
ORDER BY unsubscribe_rate DESC
LIMIT 1;

-- FOR Lowest
SELECT c.campaign_name, cp.total_unsubscribes*1.0/cp.total_sent AS unsubscribe_rate
FROM Campaigns c
JOIN Campaign_Performance cp ON c.campaign_id = cp.campaign_id
ORDER BY unsubscribe_rate ASC
LIMIT 1;

--(3) Do the certain campaign categories (promotion, newsletter, reengagement, announcement)have higher unsubscribe rates?
SELECT 
    c.category,
    SUM(cp.total_unsubscribes) * 1.0 / SUM(cp.total_sent) AS unsubscribe_rate
FROM Campaigns c
JOIN Campaign_Performance cp ON c.campaign_id = cp.campaign_id
GROUP BY c.category
ORDER BY unsubscribe_rate DESC;

--(4) What's the relationship between open rate and unsubscribe rate?

SELECT 
    c.campaign_name,
    cp.total_opens*1.0/cp.total_sent AS open_rate,
    cp.total_unsubscribes*1.0/cp.total_sent AS unsubscribe_rate
FROM Campaigns c
JOIN Campaign_Performance cp ON c.campaign_id = cp.campaign_id;

--(5)Which regions or device types have the highest unsubscribe rate?

SELECT 
    u.region,
    COUNT(DISTINCT us.user_id) * 1.0 / COUNT(DISTINCT u.user_id) AS unsubscribe_rate
FROM Users u
LEFT JOIN Unsubscribes us ON u.user_id = us.user_id
GROUP BY u.region;


--Device type
SELECT 
    u.device_type,
    COUNT(DISTINCT un.user_id) * 1.0 / COUNT(DISTINCT u.user_id) AS unsubscribe_rate
FROM Users u
LEFT JOIN Unsubscribes un 
    ON u.user_id = un.user_id
GROUP BY u.device_type
ORDER BY unsubscribe_rate DESC;

--(6)How long after signup do users typically unsubscribe?
--calculate the time difference between signup_date in Users and unsubscribe_date in Unsubscribes.

SELECT 
    u.user_id,
    julianday(un.unsubscribe_date) - julianday(u.signup_date) AS days_to_unsubscribe
FROM Users u
JOIN Unsubscribes un ON u.user_id = un.user_id
WHERE julianday(un.unsubscribe_date) &gt;= julianday(u.signup_date);


--THEN analyze the distribution to see the typical unsubscribe timing.


SELECT 
    AVG(julianday(un.unsubscribe_date) - julianday(u.signup_date)) AS avg_days_to_unsubscribe,
    MIN(julianday(un.unsubscribe_date) - julianday(u.signup_date)) AS min_days,
    MAX(julianday(un.unsubscribe_date) - julianday(u.signup_date)) AS max_days
FROM Users u
JOIN Unsubscribes un ON u.user_id = un.user_id
WHERE julianday(un.unsubscribe_date) &gt;= julianday(u.signup_date);



--(7)Does send time(hour of the day) impact engagement or unsubscribe rates?
SELECT 
    c.send_hour,
    AVG(cp.total_opens*1.0/cp.total_sent) AS avg_open_rate,
    AVG(cp.total_clicks*1.0/cp.total_sent) AS avg_click_rate,
    AVG(cp.total_unsubscribes*1.0/cp.total_sent) AS avg_unsubscribe_rate
FROM Campaigns c
JOIN Campaign_Performance cp ON c.campaign_id = cp.campaign_id
GROUP BY c.send_hour
ORDER BY c.send_hour;

--(7)What are the most common reasons and do they vary by campaign category ?

SELECT 
    reason,
    COUNT(*) AS count
FROM Unsubscribes un
JOIN Campaigns c ON un.campaign_id = c.campaign_id
GROUP BY reason
ORDER BY count DESC;

SELECT 
    c.category,
    un.reason,
    COUNT(*) AS count
FROM Unsubscribes un
JOIN Campaigns c ON un.campaign_id = c.campaign_id
GROUP BY c.category, un.reason
ORDER BY c.category, count DESC;

--(8)Who are the at risk users?
-- Aggregate engagement per user
WITH user_engagement AS (
    SELECT 
        user_id,
        COUNT(*) AS total_emails,
        SUM(opened) AS total_opened,
        SUM(clicked) AS total_clicked,
        SUM(unsubscribe) AS total_unsub
    FROM Email_Engagement
    GROUP BY user_id
),



user_rates AS (
    SELECT
        ue.user_id,
        ue.total_emails,
        ue.total_opened,
        ue.total_clicked,
        ue.total_unsub,
        CAST(ue.total_opened AS REAL)/ue.total_emails AS open_rate,
        CAST(ue.total_clicked AS REAL)/ue.total_emails AS click_rate
    FROM user_engagement ue
)

SELECT 
    u.user_id,
    u.region,
    u.device_type,
    ur.open_rate,
    ur.click_rate,
    CASE WHEN un.user_id IS NOT NULL THEN 1 ELSE 0 END AS past_unsubscribe,
    CASE 
        WHEN (ur.open_rate &lt; 0.2 AND ur.click_rate &lt; 0.1) OR un.user_id IS NOT NULL THEN 1
        ELSE 0
    END AS at_risk
FROM Users u
LEFT JOIN user_rates ur ON u.user_id = ur.user_id
LEFT JOIN Unsubscribes un ON u.user_id = un.user_id
WHERE (ur.open_rate &lt; 0.2 AND ur.click_rate &lt; 0.1) OR un.user_id IS NOT NULL;

</sql><current_tab id="0"/></tab_sql></sqlb_project>
